================================================================================
IDSS BACKEND - RESEARCH CONTRIBUTIONS & MEETING NOTES
================================================================================
Summary for discussion: database expansion, categories, interview flow, knowledge
graph, frontend integration, and bug fixes across 30+ commits.
================================================================================

1. NEW PRODUCTS & DATABASE EXPANSION
-------------------------------------
- Total products: ~4,105 (from ~1,200 baseline)
- Seed data: newBOOKS.json, newJEWELRY.json, newLAPTOPS.json, records (1-4).json
- Shopify integration: 105+ products from 7 stores (Allbirds, Gymshark, ColourPop,
  Kylie Cosmetics, Fashion Nova, Tattly, Pura Vida)
- WooCommerce scrapers for additional product sources
- Fill product gaps: jewelry, accessories, beauty, clothing, art
- Database expansion scripts: expand_database_massive.py, expand_to_500_products_each.py
- Review system: 4,105 products with reviews (100% coverage), ratings 1-5

2. CATEGORIES & PRODUCT TYPES
-----------------------------
- Electronics: 1,105+ laptops (Gaming, Work, School, Creative subcategories)
- Books: 500 (Fiction, Mystery, Sci-Fi, Non-Fiction, Self-Help, etc.)
- Jewelry: Necklace, Earrings, Bracelet, Ring, Pendant
- Accessories: Scarf, Hat, Belt, Bag, Watch, Sunglasses
- Clothing: Dresses, Shirts & Blouses, Pants, Graphic Tees, Shorts, Jackets
- Beauty: Lipstick, Eyeshadow, Mascara, Skincare, Foundation, Blush
- Art: Temporary tattoos, party packs
- 14+ distinct categories in database

3. WEBSITE & FRONTEND IMPROVEMENTS
-----------------------------------
- Recommendation buttons: "See similar items", "Research", "Compare items",
  "Help with checkout", "Rate recommendations"
- Quick replies for interview flow: category selection, type, budget, brand
- NO_MATCH handling: "Show me all X", "Increase my budget", "Try a different brand"
- Post-recommendation: "Broaden search", "Different category", "Show more like these"
- Rating flow: 5 stars, 4 stars, 3 stars, "Could be better"
- Different category resets session and shows category picker
- Session persistence for Beauty, Jewelry, Clothing, Accessories (like laptops/books)

4. KNOWLEDGE GRAPH (NEO4J)
--------------------------
- kg.txt compliance: node labels (Product, Book, Laptop, Jewelry, etc.)
- Relationship types: BELONGS_TO_GENRE, BRANDED_BY, HAS_CPU, HAS_GPU, etc.
- Knowledge graph builder and build scripts
- KG service for product search (candidate ranking)
- Neo4j docker compose and config
- Populate KG for electronics, books, jewelry

5. INTERVIEW FLOW & CONVERSATION
---------------------------------
- Domain registry: vehicles, laptops, books, jewelry, accessories, clothing, beauty
- Query specificity: typo correction, synonym expansion, brand extraction
- Beauty/Jewelry/Clothing brand options (Nike, Patagonia, Uniqlo, MAC, NARS, etc.)
- Session merge: explicit_filters from session for "NARS" / brand answers
- Fixed repeated "Do you have a preferred brand?" loop
- Input validation: fuzzy matching, LLM validator for ambiguous input
- Removed Levi's from Clothing (no products in DB)

6. SEARCH & FILTERING
---------------------
- Relax filters on no results: drop price_min first, then subcategory
- Fenty Beauty + Foundation: shows $27-$40 products even when user said $50-$100
- OR operations: "Dell OR HP laptop"
- Query parser, or_filter_parser for complex queries

7. TESTING & VERIFICATION
-------------------------
- Test endpoints: PostgreSQL (not SQLite), cleanup order, e2e flow
- test_query_normalizer: changed metadata only for text modifications
- test_endpoint_integration: PostgreSQL, asyncio.run for sync tests
- final_integration_test: 49/49 passed, 4,105 products
- Benchmark and integration tests, latency verification

8. BUG FIXES (RECENT SESSION)
-----------------------------
- "Show me all accessories" not understood → added to post-rec validation
- Levi's/Patagonia/Nike brand answers rejected → added to interview validation
- Clothing budget $100-$200 rejected → added to validation list
- "Different category" not resetting → added to reset_keywords
- Beauty brand question loop → session merge + persist for all domains
- Query normalizer: changed=True only for text changes, not synonym expansions

9. KEY FILES & MODULES
----------------------
- mcp-server/app/chat_endpoint.py: process_chat, validation, _search_ecommerce_products
- mcp-server/app/endpoints.py: search_products, session merge, product_type
- mcp-server/app/domain_registry.py: domain schemas, slot definitions
- mcp-server/app/query_specificity.py: is_specific_query, brand extraction
- mcp-server/app/kg_service.py: Neo4j KG search
- mcp-server/app/idss_adapter.py: routing to IDSS backend (vehicles)

10. COMMIT HISTORY (SELECTED)
-----------------------------
de39ada Seed data: newBOOKS, newJEWELRY, newLAPTOPS, records, shopify results
3af3712 Benchmark and integration tests
edfa63f Database expansion and scraper scripts
b212502 Shopify integration scripts
64f443a Fill product gaps: jewelry, accessories, beauty
20a1b29 Conversation controller and domain registry
c41bcab Add KG service for product search
311dc5f Add knowledge graph builder and build scripts
323ca09 Add Neo4j docker compose and config
782804f Merge remote changes with domain-aware IDSS implementation (base)

================================================================================
END OF MEETING NOTES
================================================================================
